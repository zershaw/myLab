package com.cbsys.saleexplore.util;

import org.junit.Assert;
import org.junit.Test;

import java.util.Arrays;
import java.util.List;

public class DateTimeUtilTest {

    @Test
    public void openingHoursSerializerTest() throws Exception {
        serializerTestHelper("" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000",
                Arrays.asList(new String[][]{
                        {"0600", "1800"},
                        {"0600", "1800"},
                        {"0600", "1800"},
                        {"0600", "1800"},
                        {"0600", "1800"},
                        {"0600", "1800"},
                        {"0600", "1800"},
                }));


        serializerTestHelper("" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000",
                Arrays.asList(new String[][]{
                        {"1000", "2200"},
                        {"1000", "2200"},
                        {"1000", "2200"},
                        {"1000", "2200"},
                        {"1000", "2200"},
                        {"1000", "2200"},
                        {"1000", "2200"}
                }));


        serializerTestHelper("" +
                        "000000000000000000011111111111111111111111111000" +
                        "000000000000000000011111111111111111111111111000" +
                        "000000000000000000011111111111111111111111111000" +
                        "000000000000000000011111111111111111111111111000" +
                        "000000000000000000011111111111111111111111111000" +
                        "000000000000000000001111111111111111111111110000" +
                        "000000000000000000001111111111111111111111110000",
                Arrays.asList(new String[][]{
                        {"0930", "2230"},
                        {"0930", "2230"},
                        {"0930", "2230"},
                        {"0930", "2230"},
                        {"0930", "2230"},
                        {"1000", "2200"},
                        {"1000", "2200"}
                }));


        // Corner case, opens for 24 hours
        serializerTestHelper("" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111" +
                        "111111111111111111111111111111111111111111111111",
                Arrays.asList(new String[][]{
                        {"0000", "2400"},
                        {"0000", "2400"},
                        {"0000", "2400"},
                        {"0000", "2400"},
                        {"0000", "2400"},
                        {"0000", "2400"},
                        {"0000", "2400"},
                }));
    }

    private void serializerTestHelper(String expectedRes, List<String[]> openingHours) throws Exception {

        Assert.assertEquals(expectedRes,
                OpeningHourUtil.openingHoursSerializer(openingHours));
    }



    @Test
    public void openingHoursDeserializerTest() throws Exception {


        deserializerTestHelper(
                Arrays.asList(
                        new String[][]{
                                {"0930", "2130"}, {"0930", "2130"}, {"0930", "2130"}, {"0930", "2130"},
                                {"0930", "2130"}, {"0930", "2130"}, {"0930", "2130"}}),
                "" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000" +
                        "000000000000000000011111111111111111111111100000"
        );

        deserializerTestHelper(
                Arrays.asList(
                        new String[][]{
                                {"0600", "1800"}, {"0600", "1800"}, {"0600", "1800"}, {"0600", "1800"},
                                {"0600", "1800"}, {"0600", "1800"}, {"0600", "1800"}}),
                "" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000" +
                        "000000000000111111111111111111111111000000000000"
        );
    }

    private void deserializerTestHelper(List<String[]> expectedRes, String openingHours) {

        Assert.assertArrayEquals(expectedRes.toArray(),
                OpeningHourUtil.openingHoursDeserializer(openingHours).toArray());
    }

    @Test
    public void isOpenTest() {
        String inputDate = "" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000" +
                "000000000000000000011111111111111111111111100000";

        List<String[]> desrializedOpenHours = OpeningHourUtil.openingHoursDeserializer(inputDate);

        for (int i = 0; i < desrializedOpenHours.size(); i ++) {
            System.out.println("Day " + i + ", open from: " + desrializedOpenHours.get(i)[0]
                    + ", closed at: " + desrializedOpenHours.get(i)[1]);
        }

        System.out.println("Is it opened now: " + OpeningHourUtil.isOpen(desrializedOpenHours));
    }

}
